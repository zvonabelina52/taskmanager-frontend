<div class="task-manager">
  <header class="header">
    <div>
      <h1>ğŸ“‹ Task Manager</h1>
      <p class="welcome">Welcome, {{ currentUser()?.username }}!</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="toggleForm()">
        {{ showForm ? 'Cancel' : '+ New Task' }}
      </button>
      <button class="btn btn-secondary" (click)="logout()">
        Logout
      </button>
    </div>
  </header>

  <div class="error" *ngIf="error">
    {{ error }}
  </div>

  <!-- Loading State -->
  <div class="loading" *ngIf="loading">
    <div class="spinner"></div>
    <p>Loading your tasks...</p>
  </div>

  <!-- Empty State (when not loading and no tasks) -->
  <div class="empty-state-main" *ngIf="!loading && tasks.length === 0 && !showForm">
    <div class="empty-icon">ğŸ“</div>
    <h2>No tasks yet!</h2>
    <p>You don't have any tasks. Create one by clicking the "New Task" button above.</p>
  </div>

  <!-- New Task Form -->
  <div class="task-form" *ngIf="showForm">
    <h2>Create New Task</h2>
    <form (ngSubmit)="createTask()">
      <div class="form-group">
        <label for="title">Title *</label>
        <input 
          type="text" 
          id="title" 
          [(ngModel)]="newTask.title" 
          name="title"
          placeholder="Enter task title"
          required
          data-cy="task-title">
      </div>

      <div class="form-group">
        <label for="description">Description</label>
        <textarea 
          id="description" 
          [(ngModel)]="newTask.description" 
          name="description"
          placeholder="Enter task description"
          rows="3"
          data-cy="task-description"></textarea>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="priority">Priority</label>
          <select id="priority" [(ngModel)]="newTask.priority" name="priority">
            <option value="LOW">Low</option>
            <option value="MEDIUM">Medium</option>
            <option value="HIGH">High</option>
          </select>
        </div>

        <div class="form-group">
          <label for="status">Status</label>
          <select id="status" [(ngModel)]="newTask.status" name="status">
            <option value="TODO">To Do</option>
            <option value="IN_PROGRESS">In Progress</option>
            <option value="DONE">Done</option>
          </select>
        </div>
      </div>

      <button type="submit" class="btn btn-primary" data-cy="save-task-btn">
        Create Task
      </button>
    </form>
  </div>

  <!-- Kanban Board (only show when not loading and has tasks) -->
  <div class="kanban-board" *ngIf="!loading && tasks.length > 0">
    <div class="kanban-column">
      <h3 class="column-header todo">ğŸ“ To Do ({{ getTasksByStatus('TODO').length }})</h3>
      <div class="tasks">
        <div class="task-card" *ngFor="let task of getTasksByStatus('TODO')">
          <div class="task-header">
            <h4>{{ task.title }}</h4>
            <span class="priority" [class]="'priority-' + task.priority.toLowerCase()">
              {{ task.priority }}
            </span>
          </div>
          <p class="task-description">{{ task.description }}</p>
          <div class="task-actions">
            <button class="btn-small btn-success" (click)="updateTaskStatus(task, 'IN_PROGRESS')">
              Start â†’
            </button>
            <button class="btn-small btn-danger" (click)="deleteTask(task.id!)">
              ğŸ—‘ï¸
            </button>
          </div>
        </div>
        <div class="empty-state" *ngIf="getTasksByStatus('TODO').length === 0">
          No tasks to do
        </div>
      </div>
    </div>

    <div class="kanban-column">
      <h3 class="column-header in-progress">âš™ï¸ In Progress ({{ getTasksByStatus('IN_PROGRESS').length }})</h3>
      <div class="tasks">
        <div class="task-card" *ngFor="let task of getTasksByStatus('IN_PROGRESS')">
          <div class="task-header">
            <h4>{{ task.title }}</h4>
            <span class="priority" [class]="'priority-' + task.priority.toLowerCase()">
              {{ task.priority }}
            </span>
          </div>
          <p class="task-description">{{ task.description }}</p>
          <div class="task-actions">
            <button class="btn-small btn-warning" (click)="updateTaskStatus(task, 'TODO')">
              â† Back
            </button>
            <button class="btn-small btn-success" (click)="updateTaskStatus(task, 'DONE')">
              Done âœ“
            </button>
            <button class="btn-small btn-danger" (click)="deleteTask(task.id!)">
              ğŸ—‘ï¸
            </button>
          </div>
        </div>
        <div class="empty-state" *ngIf="getTasksByStatus('IN_PROGRESS').length === 0">
          No tasks in progress
        </div>
      </div>
    </div>

    <div class="kanban-column">
      <h3 class="column-header done">âœ… Done ({{ getTasksByStatus('DONE').length }})</h3>
      <div class="tasks">
        <div class="task-card done" *ngFor="let task of getTasksByStatus('DONE')">
          <div class="task-header">
            <h4>{{ task.title }}</h4>
            <span class="priority" [class]="'priority-' + task.priority.toLowerCase()">
              {{ task.priority }}
            </span>
          </div>
          <p class="task-description">{{ task.description }}</p>
          <div class="task-actions">
            <button class="btn-small btn-warning" (click)="updateTaskStatus(task, 'IN_PROGRESS')">
              â† Reopen
            </button>
            <button class="btn-small btn-danger" (click)="deleteTask(task.id!)">
              ğŸ—‘ï¸
            </button>
          </div>
        </div>
        <div class="empty-state" *ngIf="getTasksByStatus('DONE').length === 0">
          No completed tasks
        </div>
      </div>
    </div>
  </div>
</div>